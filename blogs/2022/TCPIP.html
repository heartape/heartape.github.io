<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>TCP/IP协议栈 | Heartape</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="favicon.ico">
    <script src="/assets/js/bodyClick.js"></script>
    <meta name="description" content="你也想起舞吗">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <link rel="preload" href="/assets/css/0.styles.1838edc9.css" as="style"><link rel="preload" href="/assets/js/app.1dfee411.js" as="script"><link rel="preload" href="/assets/js/3.ff3158d3.js" as="script"><link rel="preload" href="/assets/js/1.3cfe66ce.js" as="script"><link rel="preload" href="/assets/js/37.2d252ea1.js" as="script"><link rel="prefetch" href="/assets/js/10.4d89ebc6.js"><link rel="prefetch" href="/assets/js/11.45271f39.js"><link rel="prefetch" href="/assets/js/12.d5dc49fd.js"><link rel="prefetch" href="/assets/js/13.6aa3d578.js"><link rel="prefetch" href="/assets/js/14.e1085e78.js"><link rel="prefetch" href="/assets/js/15.8f272aaa.js"><link rel="prefetch" href="/assets/js/16.03035411.js"><link rel="prefetch" href="/assets/js/17.9bc46330.js"><link rel="prefetch" href="/assets/js/18.75aa800b.js"><link rel="prefetch" href="/assets/js/19.5d1cea08.js"><link rel="prefetch" href="/assets/js/20.6e79f9e8.js"><link rel="prefetch" href="/assets/js/21.309641c4.js"><link rel="prefetch" href="/assets/js/22.f3e195c3.js"><link rel="prefetch" href="/assets/js/23.1d388489.js"><link rel="prefetch" href="/assets/js/24.26f6c023.js"><link rel="prefetch" href="/assets/js/25.d0dcc996.js"><link rel="prefetch" href="/assets/js/26.b1102314.js"><link rel="prefetch" href="/assets/js/27.e186ee85.js"><link rel="prefetch" href="/assets/js/28.34c09564.js"><link rel="prefetch" href="/assets/js/29.76f52ba3.js"><link rel="prefetch" href="/assets/js/30.4a4b1f6b.js"><link rel="prefetch" href="/assets/js/31.ab6c0f0c.js"><link rel="prefetch" href="/assets/js/32.7223673a.js"><link rel="prefetch" href="/assets/js/33.be99070f.js"><link rel="prefetch" href="/assets/js/34.e3019eed.js"><link rel="prefetch" href="/assets/js/35.bc13ecc2.js"><link rel="prefetch" href="/assets/js/36.87feef88.js"><link rel="prefetch" href="/assets/js/38.6a1b531b.js"><link rel="prefetch" href="/assets/js/39.c9c5d2ec.js"><link rel="prefetch" href="/assets/js/4.5018e831.js"><link rel="prefetch" href="/assets/js/40.2ebaf5a5.js"><link rel="prefetch" href="/assets/js/41.7cec11ce.js"><link rel="prefetch" href="/assets/js/42.dbeb1d7a.js"><link rel="prefetch" href="/assets/js/43.445fa9ea.js"><link rel="prefetch" href="/assets/js/44.3922a90a.js"><link rel="prefetch" href="/assets/js/45.b5635c24.js"><link rel="prefetch" href="/assets/js/46.27274518.js"><link rel="prefetch" href="/assets/js/47.fa892615.js"><link rel="prefetch" href="/assets/js/48.f3da6eff.js"><link rel="prefetch" href="/assets/js/49.162636a5.js"><link rel="prefetch" href="/assets/js/5.3711aac4.js"><link rel="prefetch" href="/assets/js/50.14e6e66d.js"><link rel="prefetch" href="/assets/js/51.043ce8e8.js"><link rel="prefetch" href="/assets/js/52.2567289a.js"><link rel="prefetch" href="/assets/js/53.4f16b691.js"><link rel="prefetch" href="/assets/js/54.6aeea81d.js"><link rel="prefetch" href="/assets/js/55.b8b60cdd.js"><link rel="prefetch" href="/assets/js/56.fc75d6da.js"><link rel="prefetch" href="/assets/js/57.4a0b4cca.js"><link rel="prefetch" href="/assets/js/58.44b4b7d2.js"><link rel="prefetch" href="/assets/js/59.0dd317c4.js"><link rel="prefetch" href="/assets/js/6.61315c04.js"><link rel="prefetch" href="/assets/js/60.3b656777.js"><link rel="prefetch" href="/assets/js/61.736462c6.js"><link rel="prefetch" href="/assets/js/62.693989d7.js"><link rel="prefetch" href="/assets/js/63.939cce4a.js"><link rel="prefetch" href="/assets/js/64.e2c20a7e.js"><link rel="prefetch" href="/assets/js/65.85a9b6b1.js"><link rel="prefetch" href="/assets/js/66.4a05d05a.js"><link rel="prefetch" href="/assets/js/67.9ed7d25e.js"><link rel="prefetch" href="/assets/js/68.99faca33.js"><link rel="prefetch" href="/assets/js/69.be8a17a6.js"><link rel="prefetch" href="/assets/js/7.2611c62d.js"><link rel="prefetch" href="/assets/js/70.17327394.js"><link rel="prefetch" href="/assets/js/71.4f5fe391.js"><link rel="prefetch" href="/assets/js/72.567d7b67.js"><link rel="prefetch" href="/assets/js/73.f5aab981.js"><link rel="prefetch" href="/assets/js/74.58c6da28.js"><link rel="prefetch" href="/assets/js/8.60de4a3c.js"><link rel="prefetch" href="/assets/js/9.aed3cbfa.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1838edc9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-dad8a512><div data-v-dad8a512><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-dad8a512 data-v-dad8a512><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-64685f0e data-v-dad8a512 data-v-dad8a512><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>Heartape</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>Heartape</span>
            
          <span data-v-64685f0e>2022 - </span>
          2023
        </a></span></div></div> <div class="hide" data-v-dad8a512><header class="navbar" data-v-dad8a512><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/image/hero.png" alt="Heartape" class="logo"> <span class="site-name">Heartape</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-blog"></i>
      技术
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blogs/docs/java/java8.html" class="nav-link"><i class="iconfont undefined"></i>
  JAVA
</a></li><li class="dropdown-item"><!----> <a href="/blogs/docs/frame/spring5.html" class="nav-link"><i class="iconfont undefined"></i>
  框架
</a></li><li class="dropdown-item"><!----> <a href="/blogs/docs/source/springSource.html" class="nav-link"><i class="iconfont undefined"></i>
  源码
</a></li><li class="dropdown-item"><!----> <a href="/blogs/docs/middleware/mysql.html" class="nav-link"><i class="iconfont undefined"></i>
  中间件
</a></li><li class="dropdown-item"><!----> <a href="/blogs/docs/tool/git.html" class="nav-link"><i class="iconfont undefined"></i>
  工具
</a></li></ul></div></div><div class="nav-item"><a href="/blogs/novel/novel1.html" class="nav-link"><i class="iconfont reco-api"></i>
  小说
</a></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时光走过了哪里
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-account"></i>
      我在哪里
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/heartape" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/heartape" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-mayun"></i>
  Gitee
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://space.bilibili.com/247318527" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-bilibili"></i>
  Bilibili
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="mailto:heartape@163.com" class="nav-link external"><i class="iconfont reco-mail"></i>
  163
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-dad8a512></div> <aside class="sidebar" data-v-dad8a512><div class="personal-info-wrapper" data-v-ca798c94 data-v-dad8a512><img src="/assets/image/hero.png" alt="author-avatar" class="personal-img" data-v-ca798c94> <h3 class="name" data-v-ca798c94>
    Heartape
  </h3> <div class="num" data-v-ca798c94><div data-v-ca798c94><h3 data-v-ca798c94>38</h3> <h6 data-v-ca798c94>文章</h6></div> <div data-v-ca798c94><h3 data-v-ca798c94>42</h3> <h6 data-v-ca798c94>标签</h6></div></div> <hr data-v-ca798c94></div> <nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-blog"></i>
      技术
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blogs/docs/java/java8.html" class="nav-link"><i class="iconfont undefined"></i>
  JAVA
</a></li><li class="dropdown-item"><!----> <a href="/blogs/docs/frame/spring5.html" class="nav-link"><i class="iconfont undefined"></i>
  框架
</a></li><li class="dropdown-item"><!----> <a href="/blogs/docs/source/springSource.html" class="nav-link"><i class="iconfont undefined"></i>
  源码
</a></li><li class="dropdown-item"><!----> <a href="/blogs/docs/middleware/mysql.html" class="nav-link"><i class="iconfont undefined"></i>
  中间件
</a></li><li class="dropdown-item"><!----> <a href="/blogs/docs/tool/git.html" class="nav-link"><i class="iconfont undefined"></i>
  工具
</a></li></ul></div></div><div class="nav-item"><a href="/blogs/novel/novel1.html" class="nav-link"><i class="iconfont reco-api"></i>
  小说
</a></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时光走过了哪里
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-account"></i>
      我在哪里
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/heartape" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/heartape" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-mayun"></i>
  Gitee
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://space.bilibili.com/247318527" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-bilibili"></i>
  Bilibili
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="mailto:heartape@163.com" class="nav-link external"><i class="iconfont reco-mail"></i>
  163
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-64685f0e data-v-dad8a512><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>TCP/IP协议栈</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>Heartape</span>
            
          <span data-v-64685f0e>2022 - </span>
          2023
        </a></span></div></div> <div data-v-dad8a512><main class="page"><div class="page-title" style="display:none;"><h1>TCP/IP协议栈</h1> <div data-v-3b7f5bdf><i class="iconfont reco-account" data-v-3b7f5bdf><span data-v-3b7f5bdf>Heartape</span></i> <i class="iconfont reco-date" data-v-3b7f5bdf><span data-v-3b7f5bdf>2022-06-12</span></i> <!----> <i class="iconfont reco-tag tags" data-v-3b7f5bdf><span class="tag-item" data-v-3b7f5bdf>tcp/ip</span></i></div></div> <div class="theme-reco-content content__default" style="display:none;"><h2 id="_1-tcp-ip协议体系的认知"><a href="#_1-tcp-ip协议体系的认知" class="header-anchor">#</a> 1.	TCP/IP协议体系的认知</h2> <p>是利用 IP 进行通信时所必须用到的协议群的统称.</p> <p>一部分处于用户态，一部分处于内核态。数据链路层，网络层，传输层封装于操作系统内核态。应用层存在于操作系统的用户空间，包括DNS，FTP，HTTPs，HTTP，工作中接触较多的是应用层的部分。但其它层的原理必须理解，面试考察。</p> <p>层与层之间下层对上层是透明的，传输在每一层是对等的。</p> <h2 id="_2-数据链路层"><a href="#_2-数据链路层" class="header-anchor">#</a> 2.	数据链路层</h2> <h3 id="_1-以太网数据帧格式"><a href="#_1-以太网数据帧格式" class="header-anchor">#</a> 1.	以太网数据帧格式</h3> <p><img src="/assets/image/TCPIP%E5%8D%8F%E8%AE%AE%E6%A0%88.assets/Ethernet2.jpg" alt="Ethernet 2"></p> <p><img src="/assets/image/TCPIP%E5%8D%8F%E8%AE%AE%E6%A0%88.assets/802.3.png" alt="802.3"></p> <p><img src="/assets/image/TCPIP%E5%8D%8F%E8%AE%AE%E6%A0%88.assets/Ethernet2%E6%A0%BC%E5%BC%8F%E6%95%B0%E6%8D%AE%E5%B8%A7%E5%85%B7%E4%BD%93%E5%AD%97%E6%AE%B5.jpg" alt="Ethernet II格式数据帧具体字段"></p> <p><img src="/assets/image/TCPIP%E5%8D%8F%E8%AE%AE%E6%A0%88.assets/IEEE-802.3%E6%A0%BC%E5%BC%8F%E6%95%B0%E6%8D%AE%E5%B8%A7%E5%85%B7%E4%BD%93%E5%AD%97%E6%AE%B5.jpg" alt="IEEE 802.3格式数据帧具体字段"></p> <ul><li>DMAC（Destination MAC）是目的MAC地址。DMAC字段长度为6个字节，标识帧的接收者;</li> <li>SMAC（Source MAC）是源MAC地址。SMAC字段长度为6个字节，标识帧的发送者;</li> <li>类型字段（Type）**用于标识数据字段中包含的高层协议，该字段长度为2个字节。类型字段取值为0x0800的帧代表IP协议帧；类型字段取值为0806的帧代表ARP协议帧;</li> <li>数据字段(Data)**是网络层数据，最小长度必须为46字节以保证帧长至少为64字节，数据字段的最大长度为1500字节;</li> <li>循环冗余校验字段（FCS）**提供了一种错误检测机制，用于检验传输过程中帧的完整性。该字段长度为4个字节。</li> <li>Length字段定义了Data字段包含的字节数;</li> <li>逻辑链路控制LLC（Logical Link Control）由目的服务访问点DSAP（Destination Service Access Point）、源服务访问点SSAP（Source Service Access Point）和Control字段组成;</li> <li>SNAP（Sub-network Access Protocol）由机构代码（Org Code）和类型（Type）字段组成。Org code三个字节都为0。Type字段的含义与Ethernet_II帧中的Type字段相同;</li></ul> <h3 id="_2-mtu（最大传输单元）"><a href="#_2-mtu（最大传输单元）" class="header-anchor">#</a> 2.	MTU（最大传输单元）</h3> <p>将报文(data部分)限制在一定的长度，一般46byte到1500byte,以太网可以将报文大概率传输到目的地.</p> <h3 id="_3-arp协议和rarp协议（网络层和链路层的中间层）"><a href="#_3-arp协议和rarp协议（网络层和链路层的中间层）" class="header-anchor">#</a> 3.	ARP协议和RARP协议（网络层和链路层的中间层）</h3> <ul><li>ARP:地址解析协议，即Address Resolution Protocol，是根据IP地址获取物理地址的一个TCP/IP协议。</li> <li>RARP:反向地址转换协议，Reverse Address Resolution Protocol。</li></ul> <p><img src="/assets/image/TCPIP%E5%8D%8F%E8%AE%AE%E6%A0%88.assets/ARP%E6%8A%A5%E6%96%87.jpg" alt="ARP报文"></p> <h4 id="arp报文"><a href="#arp报文" class="header-anchor">#</a> ARP报文:</h4> <ul><li><p>ARP request报文（广播报文）来获取以太网地址(MAC地址)。而广播报文只会在广播域中传播，路由器可以隔离广播域。</p></li> <li><p>以太网报头中的前两个字段是以太网的源地址和目的地址;</p></li> <li><p>两个字节长的以太网帧类型表示后面数据的类型。对于ARP请求或应答来说，该字段的值为0x0806;</p></li> <li><p>硬件类型字段表示硬件地址的类型。它的值为1即表示以太网地址。协议类型字段表示要映射的协议地址类型。它的值为0x0800即表示IP地址;</p></li> <li><p>硬件地址长度和协议地址长度分别指出硬件地址和协议地址的长度，在以太网上IP地址的ARP请求或应答，它们的值分别为6和4;</p></li> <li><p>操作字段指出四种操作类型，它们是ARP请求（值为1）、ARP应答（值为2）、RARP请求（值为3）和RARP应答（值为4）;</p></li> <li><p>查询原理:</p></li></ul> <p>主机发送信息时，将包含目标IP地址的ARP请求广播到网络上的所有主机，并接收返回消息，以此确定目标的物理地址；</p> <ul><li>缓存机制:</li></ul> <p>ARP缓存表中保存这网络中各个电脑的IP地址和MAC地址的对照关系。主机将收到的物理地址和IP地址存入本机ARP缓存中并保留一定时间，下次请求时直接查询ARP缓存以节约资源。</p> <h4 id="rarp报文"><a href="#rarp报文" class="header-anchor">#</a> RARP报文:</h4> <p>RARP分组的格式与ARP分组基本一致。它们之间主要的差别是RARP请求或应答的帧类型代码为0x8035，而且RARP请求的操作代码为3，应答操作代码为4;</p> <ul><li>查询原理:</li></ul> <p>反向地址转换协议（RARP）允许局域网的物理机器从网关服务器的 ARP 表或者缓存上请求其 IP 地址。网络管理员在局域网的网关路由器里创建一个表以映射物理地址（MAC）和与其对应的 IP 地址。当设置一台新的机器时，其 RARP 客户机程序需要向路由器上的 RARP 服务器请求相应的 IP 地址。假设在路由表中已经设置了一个记录，RARP 服务器将会返回 IP 地址给机器，此机器就会存储起来以便日后使用;</p> <h2 id="_3-网络层"><a href="#_3-网络层" class="header-anchor">#</a> 3.	网络层</h2> <h3 id="_1-ip首部格式"><a href="#_1-ip首部格式" class="header-anchor">#</a> 1.	IP首部格式</h3> <p><img src="/assets/image/TCPIP%E5%8D%8F%E8%AE%AE%E6%A0%88.assets/IP%E9%A6%96%E9%83%A8%E6%A0%BC%E5%BC%8F.jpg" alt="IP首部格式"></p> <ul><li><p>版本:占4位，指IP协议的版本。通信双方使用的IP协议的版本必须一致;</p></li> <li><p>首部长度:占4位，可表示的最大十进制数值是15,首部长度字段所表示数的单位是32位字(1个32位字长是4字节);</p></li> <li><p>服务类型:旧标准中叫服务类型，但实际上-直没有被使用过。后改名为区分服务DS,只有在使用区分服务时，这个字段才起作用;</p></li> <li><p>总长度:总长度指首部和数据之和的长度;</p></li> <li><p>标识(identification):占16位。IP软件在存储器中维持一个计数器，每产生一个数据报，计数器就加1, 并将此值赋给标识字段。但这个“标识”并不是序号，因为IP是无连接服务，数据报不存在按序接收的问题。当数据报由于长度超过网络的MTU而必须分片时，这个标识字段的值就被复制到所有的数据报片的标识字段中。相同的标识字段的值使分片后的各数据报片最后能正确地重装成为原来的数据报;</p></li> <li><p>标志(flag):占3位，但目前只有两位有意义。最低位记为MF (More Fragment)。 MF = 1即表示后面“还有分片”的数据报。MF = 0表示这已是若干数据报片中的最后-一个。中间的一位记为DF (Don't Fragment), 意思是“不能分片”。只有当DF=0时才允许分片。</p></li> <li><p>片偏移:占13位。片偏移指出:较长的分组在分片后，某片在原分组中的相对位置;</p></li> <li><p>生存时间:占8位，生存时间字段常用的英文缩写是TTL (Time To Live), 表明这是数据报在网络中的寿命。最初的设计是以秒作为TTL值的单位。每经过一个路由器时，就把TTL减去数据报在路由器所消耗掉的一-段时间。然而随着技术的进步，路由器处理数据报所需的时间不断在缩短，一般都远远小于1秒，后来就把TTL字段的功能改为“跳数限制”(但名称不变)。因此，现在ttl的单位不再是秒，而是跳数。</p></li> <li><p>首部检验和:占16位。这个字段只检验数据报的首部，但不包括数据部分。这是因为数据报每经过一一个路由器，路由器都要重新计算一下首部检验和(一些字段，如生存时间、标志、片偏移等都可能发生变化)。</p></li></ul> <h3 id="_2-ip分片"><a href="#_2-ip分片" class="header-anchor">#</a> 2.	IP分片</h3> <p>当IP数据报超过帧的MTU(最大传输单元)时，它将会被分片传输。</p> <p><strong>标识(identification)</strong>,<strong>标志(flag)</strong>,<strong>片偏移</strong>三个字段与IP分片相关,<strong>片偏移</strong>确定分片顺序,**标志(flag)**确定分片是否全部到达</p> <p>一个IP数据报的每个分片都具有自己的IP头部信息，它们<strong>都具有相同的标识值</strong>，但是<strong>具有不同的位偏移</strong>，且<strong>除了最后一个分片外，其他分片都将设置MF标志</strong>。此外，<strong>每个分片的IP头部的总长度字段将被设置为该分片的长度</strong>。</p> <p><img src="/assets/image/TCPIP%E5%8D%8F%E8%AE%AE%E6%A0%88.assets/%E5%88%86%E7%89%87.jpg" alt="分片"></p> <p><img src="/assets/image/TCPIP%E5%8D%8F%E8%AE%AE%E6%A0%88.assets/%E5%88%86%E7%89%871.jpg" alt="分片1"></p> <h4 id="缺点"><a href="#缺点" class="header-anchor">#</a> 缺点:</h4> <ol><li>分片带来的性能消耗</li></ol> <p>消耗发送方、接收方一定的CPU和接收方内存,因为接收方要为接收到的每个分片报文分配内存空间,便于所有报文到达后完成重组;</p> <ol start="2"><li>分片丢包导致的重传问题</li></ol> <p>如果某个分片报文在网络传输过程中丢失，那么接收方将无法完成重组;</p> <ol start="3"><li>分片攻击</li></ol> <p>黑客构造的分片报文，但是不向接收方发送最后一个分片报文，持续消耗内存</p> <ol start="4"><li>安全隐患</li></ol> <p>由于分片只有第一个分片报文具有四层信息，影响路由器、防火墙等中间设备在做访问控制策略匹配。</p> <h4 id="避免ip分片"><a href="#避免ip分片" class="header-anchor">#</a> 避免IP分片:</h4> <ol><li><p>限制请求的MTU</p></li> <li><p>传输路径MTU的发现,即寻找整个路径中所能通过的最小MTU</p></li></ol> <h3 id="_3-ip选路"><a href="#_3-ip选路" class="header-anchor">#</a> 3.	IP选路</h3> <p>使用route print命令打印路由表</p> <p><img src="/assets/image/TCPIP%E5%8D%8F%E8%AE%AE%E6%A0%88.assets/%E8%B7%AF%E7%94%B1%E8%A1%A8.png" alt="路由表"></p> <p><strong>度量值</strong>意思是这台路由器去这个目标网络的代价，不同路由来源这个值的算法也不一样，直连为0。</p> <h3 id="_4-icmp（因特网控制报文协议）（理解为网络层和传输层的中间协议）"><a href="#_4-icmp（因特网控制报文协议）（理解为网络层和传输层的中间协议）" class="header-anchor">#</a> 4.	ICMP（因特网控制报文协议）（理解为网络层和传输层的中间协议）</h3> <p><img src="/assets/image/TCPIP%E5%8D%8F%E8%AE%AE%E6%A0%88.assets/icmp1.jpg" alt="icmp1"></p> <p><img src="/assets/image/TCPIP%E5%8D%8F%E8%AE%AE%E6%A0%88.assets/icmp2.jpg" alt="icmp2"></p> <p>ICMP经常被认为是IP层的一个组成部分,ICMP报文是在IP数据报内部被传输的。它传递差错报文以及其他需要注意的信息。ICMP报文通常被IP层或更高层协议（TCP或UDP）使用。</p> <p><strong>不发送差错报文</strong>:</p> <ol><li>ICMP差错报文（但是，ICMP查询报文可能会产生ICMP差错报文）。</li> <li>目的地址是广播地址（见图3-9）或多播地址（D类地址，见图1-5）的IP数据报。</li> <li>作为链路层广播的数据报。</li> <li>不是IP分片的第一片（将在11.5节介绍分片）。</li> <li>源地址不是单个主机的数据报。这就是说，源地址不能为零地址、环回地址、广播地址或多播地址。</li></ol> <p><strong>差错报文</strong>:</p> <p>1.<strong>终点不可达</strong>：终点不可达分为:网络不可达，主机不可达，协议不可达，端口不可达，需要分片但DF比特已置为1，以及源路由失败等六种情况，其代码字段分别置为0至5。当出现以上六种情况时就向源站发送终点不可达报文。</p> <p>2.<strong>源站抑制</strong>：当路由器或主机由于拥塞而丢弃数据报时，就向源站发送源站抑制报文，使源站知道应当将数据报的发送速率放慢。</p> <p>3.<strong>时间超过</strong>：当路由器收到生存时间为零的数据报时，除丢弃该数据报外，还要向源站发送时间超过报文。当目的站在预先规定的时间内不能收到一个数据报的全部数据报片时，就将已收到的数据报片都丢弃，并向源站发送时间超过报文。</p> <p>4.<strong>参数问题</strong>：当路由器或目的主机收到的数据报的首部中的字段的值不正确时，就丢弃该数据报，并向源站发送参数问题报文。</p> <p>5.<strong>改变路由</strong>:（重定向）路由器将改变路由报文发送给主机，让主机知道下次应将数据报发送给另外的路由器。</p> <p><strong>查询报文</strong>：</p> <p>1.<strong>回送请求或回答</strong>:用于进行通信的主机或路由之间，判断发送数据包是否成功到达对端的消息。可以向对端主机发送回送请求消息，也可以接收对端主机回来的回送应答消息。<strong>PING命令</strong></p> <p>2.<strong>时间戳请求或回答</strong>:可以向那些主机或路由器发送 ICMP 时间戳请求消息，然后通过接收 ICMP 时间戳应答消息获取时间信息。</p> <p><img src="/assets/image/TCPIP%E5%8D%8F%E8%AE%AE%E6%A0%88.assets/%E6%97%B6%E9%97%B4%E6%88%B3.jpg" alt="时间戳"></p> <h2 id="_4-传输层"><a href="#_4-传输层" class="header-anchor">#</a> 4.	传输层</h2> <h3 id="_1-udp协议"><a href="#_1-udp协议" class="header-anchor">#</a> 1.	UDP协议</h3> <p><img src="/assets/image/TCPIP%E5%8D%8F%E8%AE%AE%E6%A0%88.assets/udp.jpg" alt="udp"></p> <p><img src="/assets/image/TCPIP%E5%8D%8F%E8%AE%AE%E6%A0%88.assets/udp%E9%A6%96%E9%83%A8.jpg" alt="udp首部"></p> <p>UDP特点:</p> <p>1.<strong>无连接</strong>;</p> <p>2.<strong>不可靠</strong>;</p> <p>3.<strong>没有拥塞控制</strong>,能容忍一些数据的丢失，但是不能允许有较大的时延;</p> <p>4.<strong>面向报文</strong>;</p> <h3 id="_2-tcp协议（面试集中考察）"><a href="#_2-tcp协议（面试集中考察）" class="header-anchor">#</a> 2.	TCP协议（面试集中考察）</h3> <h4 id="_1-特点-首部字段-可靠机制"><a href="#_1-特点-首部字段-可靠机制" class="header-anchor">#</a> 1.	 特点 + 首部字段 + 可靠机制</h4> <p>特点: TCP提供一种面向连接的可靠的字节流服务</p> <p><img src="/assets/image/TCPIP%E5%8D%8F%E8%AE%AE%E6%A0%88.assets/TCP.jpg" alt="TCP"></p> <p><img src="/assets/image/TCPIP%E5%8D%8F%E8%AE%AE%E6%A0%88.assets/TCP%E9%A6%96%E9%83%A8.jpg" alt="TCP首部"></p> <p>首部字段:</p> <ul><li><p>序号:为当前端成功发送的数据位数（由计算机生成的一个随机数作为其初始值，以后再将每次成功转发过去的字节数累加到初始值上表示数据的位置 ）;</p></li> <li><p>确认序号:为当前端成功接收的数据位数+1。（表示下一次应该收到的数据位置，发送端收到这个确认应答以后可以认为在这个序号以前的数据都已经被正常接收）;</p></li> <li><p>标志位:字段长为6，每一位从左到右分别为：URG、ACK、PSH、RST、SYN、FIN。当对应的值为1，表示有具体含义:
URG:紧急指针是否有效。为1，表示某一位需要被优先处理。
ACK:确认号是否有效，一般置为1。
PSH:提示接收端应用程序立即从TCP缓冲区把数据读走。
RST :对方要求重新建立连接，复位。
SYN:为1表示请求建立连接，并在其序列号的字段进行序列号的初始值设定。
FIN:希望断开连接;</p></li> <li><p>窗口大小:接收缓冲区的大小，TCP不允许发送超过此处所示大小的数据;</p></li> <li><p>校验和:发送端填充，CRC校验，接收校验不通过，则认为数据有问题。和UDP的区别是，UDP校验的是数据本身，TCP校验的不仅包含TCP首部，而且包含TCP数据部分;</p></li> <li><p>紧急指针:只有在URG为1时有效，该字段为1表示本报文的段中的紧急数据的指针。</p></li></ul> <p>可靠机制:</p> <ul><li><p>应用数据被分成TCP最合适的发送数据块;</p></li> <li><p>当TCP发送一个段之后，启动一个定时器，等待目的点确认收到报文，如果不能及时收到一个确认，将重发这个报文。</p></li> <li><p>当TCP收到连接端发来的数据，就会推迟几分之一秒发送一个确认。</p></li> <li><p>TCP将保持它首部和数据的检验和，这是一个端对端的检验和，目的在于检测数据在传输过程中是否发生变化。（有错误，就不确认，发送端就会重发）</p></li> <li><p>TCP是以IP报文来传送，IP数据是无序的，TCP收到所有数据后进行排序，再交给应用层</p></li> <li><p>IP数据报会重复，所以TCP会去重</p></li> <li><p>TCP能提供流量控制，TCP连接的每一个地方都有固定的缓冲空间。TCP的接收端只允许另一端发送缓存区能接纳的数据。</p></li> <li><p>TCP对字节流不做任何解释，对字节流的解释由TCP连接的双方应用层解释。</p></li></ul> <h4 id="_2-连接控制-：-三次握手，四次挥手，同时打开，同时关闭，半关闭（为什么需要-）"><a href="#_2-连接控制-：-三次握手，四次挥手，同时打开，同时关闭，半关闭（为什么需要-）" class="header-anchor">#</a> 2. 	连接控制 ： 三次握手，四次挥手，同时打开，同时关闭，半关闭（为什么需要?）</h4> <p><img src="/assets/image/TCPIP%E5%8D%8F%E8%AE%AE%E6%A0%88.assets/TCP%E8%BF%9E%E6%8E%A5.jpg" alt="TCP连接"></p> <ul><li><p>三次握手:TCP是面向连接的,所以需要双方都确认连接的建立.(<strong>SYN包=&gt;ACK包+SYN包=&gt;ACK包</strong>)如果client发出的第一个连接请求报文段并没有丢失，而是在某个网络结点长时间的滞留了，以致延误到连接释放以后的某个时间才到达server。本来这是一个早已失效的报文段。但server收到此失效的连接请求报文段后，就误认为是client再次发出的一个新的连接请求.假设不采用“三次握手”，那么只要server发出确认，新的连接就建立了。</p></li> <li><p>四次挥手:TCP是双全工(即客户端和服务器端可以互相发送和接收请求),需要双方都确认关闭连接.A发出结束报文FIN，收到B确认后A知道自己没有数据需要发送了，B知道A不再发送数据了，自己也不会接收数据了，但是此时A还是可以接收数据，B也可以发送数据；当B发出FIN报文的时候此时两边才会真正的断开连接，读写分开。</p></li></ul> <p><img src="/assets/image/TCPIP%E5%8D%8F%E8%AE%AE%E6%A0%88.assets/%E5%90%8C%E6%97%B6%E6%89%93%E5%BC%80.jpg" alt="同时打开"></p> <ul><li>同时打开:两个应用程序同时彼此执行主动打开的情况;</li></ul> <p><img src="/assets/image/TCPIP%E5%8D%8F%E8%AE%AE%E6%A0%88.assets/%E5%90%8C%E6%97%B6%E5%85%B3%E9%97%AD.jpg" alt="同时关闭"></p> <ul><li><p>同时关闭:两个应用程序同时彼此执行主动关闭的情况;</p></li> <li><p>半关闭:如果一方已经关闭或者异常终止连接而另外一方却还不知道，这样的连接就称为半关闭连接;</p></li></ul> <h4 id="_3-流量控制机制：滑动窗口-慢启动，拥塞避免，快速重传，快速恢复"><a href="#_3-流量控制机制：滑动窗口-慢启动，拥塞避免，快速重传，快速恢复" class="header-anchor">#</a> 3. 	流量控制机制：滑动窗口,慢启动，拥塞避免，快速重传，快速恢复</h4> <ul><li><p>滑动窗口:接收端主机向发送端主机通知自己可以接受数据的大小，于是发送端会发送不超过这个限度的数据，该大小限度就被称作窗口大小;</p></li> <li><p>慢启动:先把<strong>拥塞窗口 cwnd</strong> 设置为1个最大报文段MSS的数值，而后每收到一个对新的报文段的确认，就把拥塞窗口增加1个MSS的数值，这样拥塞窗口cwnd的值就随着传输轮次（一个轮次即发送完一个cwnd的MSS）呈指数级增长;</p></li> <li><p>拥塞避免:为了防止拥塞窗口cwnd增长过大引起网络拥塞，还需要设置一个<strong>慢开始门限ssthresh</strong>状态变量.当cwnd &gt;= ssthresh时，就会进入“拥塞避免算法”，让拥塞窗口cwnd缓慢地增大，每收到1个ACK拥塞窗口cwnd = cwnd + 1/cwnd，即每经过一个传输轮次就把发送方的拥塞窗口cwnd加1。这样拥塞窗口cwnd按<strong>线性</strong>规律缓慢增长，比慢开始算法的拥塞窗口增长速率缓慢得多;</p></li> <li><p>快速重传:发送方只要一连收到三个重复确认就应当立即重传对方尚未收到的报文段</p></li></ul> <p><img src="/assets/image/TCPIP%E5%8D%8F%E8%AE%AE%E6%A0%88.assets/%E5%BF%AB%E9%80%9F%E9%87%8D%E4%BC%A0.png" alt="快速重传"></p> <ul><li>快速恢复:收到三个重复确认说明网络也不那么糟糕，并不需要重新回到慢启动进行，这样可能降低效率。所以协议栈会做如下工作：</li></ul> <blockquote><ol><li>拥塞窗口减半cwnd=cwnd/2</li></ol></blockquote> <blockquote><ol start="2"><li>慢开始门限ssthresh=cwnd（减半后的值）</li></ol></blockquote> <h4 id="_4-tcp超时重传机制"><a href="#_4-tcp超时重传机制" class="header-anchor">#</a> 4.TCP超时重传机制</h4> <p>在发送一个数据之后，就开启一个定时器，若是在这个时间内没有收到发送数据的ACK确认报文，则对该报文进行重传，在达到一定次数还没有成功时放弃并发送一个复位信号。</p> <p><img src="/assets/image/TCPIP%E5%8D%8F%E8%AE%AE%E6%A0%88.assets/TCP%E8%B6%85%E6%97%B6%E9%87%8D%E4%BC%A0%E6%9C%BA%E5%88%B6.png" alt="TCP超时重传机制"></p> <p>四个定时器:</p> <p>1.重传计时器:当TCP发送报文段时，就创建该特定报文的重传计时器。可能发生两种情况：</p> <div class="language-text line-numbers-mode"><pre class="language-text"><code>1.若在计时器截止时间到之前收到了对此特定报文段的确认，则撤销此计时器。
2.若在收到了对此特定报文段的确认之前计时器截止时间到，则重传此报文段，并将计时器复位。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>2.持久计时器:TCP为每一个链接使用一个持久计时器,持久计时器的值设置为重传时间的数值。但是，若没有收到从接收端来的响应，则需发送另一个探测报文段，并将坚持计时器的值加倍和复位。发送端继续发送探测报文段，将坚持计时器设定的值加倍和复位，直到这个值增大到门限值（通常是60秒）为止。在这以后，发送端每个60秒就发送一个探测报文，直到窗口重新打开。</p> <p>3.保活计时器:每当服务器收到客户的信息，就将计时器复位。通常设置为两小时。若服务器过了两小时还没有收到客户的信息，他就发送探测报文段。若发送了10个探测报文段（每一个像个75秒）还没有响应，就假定客户除了故障，因而就终止了该连接。这种连接的断开当然不会使用四次握手，而是直接硬性的中断和客户端的TCP连接。</p> <p>4.时间等待计时器:时间等待计时器是在四次握手的时候使用的,当客户端向服务器发送最后一次确认报文时，就设定一个时间等待及时器，等待2MSL时间后再结束连接。(MSL：最长报文段寿命，大小为30s~2分钟)等待2MSL时间为了保证服务器能够收到客户机发送的最后一个确认报文,并且在此时间内足以清空所有报文.</p> <h2 id="_5-应用层"><a href="#_5-应用层" class="header-anchor">#</a> 5.	应用层</h2> <h3 id="_1-dns（域名解析）协议"><a href="#_1-dns（域名解析）协议" class="header-anchor">#</a> 1.	DNS（域名解析）协议</h3> <h4 id="_1-域名空间"><a href="#_1-域名空间" class="header-anchor">#</a> 1.	域名空间</h4> <p><img src="/assets/image/TCPIP%E5%8D%8F%E8%AE%AE%E6%A0%88.assets/%E5%9F%9F%E5%90%8D%E7%A9%BA%E9%97%B4.png" alt="域名空间"></p> <h4 id="_2-指针查询（反向查找或逆向解析）基本原理"><a href="#_2-指针查询（反向查找或逆向解析）基本原理" class="header-anchor">#</a> 2.	指针查询（反向查找或逆向解析）基本原理</h4> <h4 id="_3-dns缓存"><a href="#_3-dns缓存" class="header-anchor">#</a> 3.	DNS缓存</h4> <p>DNS返回了正确的IP之后，系统就会将这个结果临时储存起来。</p> <p>主机解析域名的顺序:</p> <p>1.浏览器缓存</p> <p>2.找本机的hosts文件</p> <p>3.路由缓存</p> <p>4.找 DNS服务器(本地域名 、顶级域名、根域名)</p> <h3 id="_2-ftp协议（活化石）"><a href="#_2-ftp协议（活化石）" class="header-anchor">#</a> 2.	FTP协议（活化石）</h3> <h4 id="_1-控制流和数据流"><a href="#_1-控制流和数据流" class="header-anchor">#</a> 1. 	控制流和数据流</h4> <p><strong>控制流</strong>:客户端希望与FTP服务器建立上传下载的数据传输时，它首先向服务器的TCP 21端口发起一个建立连接的请求，FTP服务器接受来自客户端的请求，完成连接的建立过程，这样的连接就称为FTP控制连接。</p> <p><strong>数据流</strong>:FTP控制连接建立之后，即可开始传输文件，传输文件的连接称为FTP数据连接。FTP数据连接就是FTP传输数据的过程，它有两种传输模式<strong>PASV 和 PORT</strong></p> <h4 id="_2-两种工作模式：-pasv-和-port"><a href="#_2-两种工作模式：-pasv-和-port" class="header-anchor">#</a> 2. 	两种工作模式： PASV 和 PORT</h4> <p><strong>主动模式 (PORT)</strong>:客户端随机打开一个大于 1024 的端口向服务器的命令端口 P，即 21 端口，发起连接，同时开放N +1 端口监听，并向服务器发出 “port N+1” 命令，由服务器从它自己的数据端口 (20) 主动连接到客户端指定的数据端口 (N+1)。</p> <p><strong>被动模式 (PASV)</strong>:命令连接和数据连接都由客户端发起，这样就解决了从服务器到客户端的数据端口的连接被防火墙过滤的问题.</p> <h4 id="_3-各种指令和响应码"><a href="#_3-各种指令和响应码" class="header-anchor">#</a> 3. 	各种指令和响应码</h4> <p>FTP 每个命令都有 3 到 4 个字母组成，命令后面跟参数，用空格分开。每个命令都以 &quot;\r\n&quot;结束。</p> <p>USER: 指定用户名。通常是控制连接后第一个发出的命令。“USER gaoleyi\r\n”： 用户名为gaoleyi 登录。</p> <p>PASS: 指定用户密码。该命令紧跟 USER 命令后。“PASS gaoleyi\r\n”：密码为 gaoleyi。</p> <p>SIZE: 从服务器上返回指定文件的大小。“SIZE file.txt\r\n”：如果 file.txt 文件存在，则返回该文件的大小。</p> <p>CWD: 改变工作目录。如：“CWD dirname\r\n”。</p> <p>PASV: 让服务器在数据端口监听，进入被动模式。如：“PASV\r\n”。</p> <p>PORT: 告诉 FTP 服务器客户端监听的端口号，让 FTP 服务器采用主动模式连接客户端。如：“PORT h1,h2,h3,h4,p1,p2”。</p> <p>RETR: 下载文件。“RETR file.txt \r\n”：下载文件 file.txt。</p> <p>STOR: 上传文件。“STOR file.txt\r\n”：上传文件 file.txt。</p> <p>REST: 该命令并不传送文件，而是略过指定点后的数据。此命令后应该跟其它要求文件传输的 FTP 命令。“REST 100\r\n”：重新指定文件传送的偏移量为 100 字节。</p> <p>QUIT: 关闭与服务器的连接。</p> <h4 id="_4-断点续传和匿名ftp的概念"><a href="#_4-断点续传和匿名ftp的概念" class="header-anchor">#</a> 4. 	断点续传和匿名FTP的概念</h4> <p>断点续传:需要使用命令 REST。如果在断开连接前，一个文件已经传输了 512 个字节。则断点续传开始的位置为 512，服务器会跳过传输文件的前 512 字节。</p> <p>匿名FTP:用于对远程计算机的连接，这些计算机是作为匿名或客户用户进行连接的，以将公共文件传输到用户的本地计算机。</p> <h3 id="_3-http协议"><a href="#_3-http协议" class="header-anchor">#</a> 3.	HTTP协议</h3> <p><img src="/assets/image/TCPIP%E5%8D%8F%E8%AE%AE%E6%A0%88.assets/http%E7%89%88%E6%9C%AC.jpg" alt="http版本"></p> <h4 id="_1-报文格式：请求报文，响应报文，请求头各种字段，响应头各种字段"><a href="#_1-报文格式：请求报文，响应报文，请求头各种字段，响应头各种字段" class="header-anchor">#</a> 1. 	报文格式：请求报文，响应报文，请求头各种字段，响应头各种字段</h4> <p><img src="/assets/image/TCPIP%E5%8D%8F%E8%AE%AE%E6%A0%88.assets/Http%E8%AF%B7%E6%B1%82%E6%B6%88%E6%81%AF%E7%BB%93%E6%9E%84.png" alt="Http请求消息结构"></p> <p><img src="/assets/image/TCPIP%E5%8D%8F%E8%AE%AE%E6%A0%88.assets/%E8%AF%B7%E6%B1%82%E5%A4%B4.jpg" alt="请求头"></p> <p><img src="/assets/image/TCPIP%E5%8D%8F%E8%AE%AE%E6%A0%88.assets/HTTP%E5%93%8D%E5%BA%94-1617893032903.jpg" alt="HTTP响应"></p> <p><img src="/assets/image/TCPIP%E5%8D%8F%E8%AE%AE%E6%A0%88.assets/%E5%93%8D%E5%BA%94%E5%A4%B4%E4%BE%8B.jpg" alt="响应头例"></p> <h5 id="第一部分：请求行，用来说明请求类型-要访问的资源以及所使用的http版本"><a href="#第一部分：请求行，用来说明请求类型-要访问的资源以及所使用的http版本" class="header-anchor">#</a> 第一部分：请求行，用来说明请求类型,要访问的资源以及所使用的HTTP版本.</h5> <p>GET说明请求类型为GET,[/562f25980001b1b106000338.jpg]为要访问的资源，该行的最后一部分说明使用的是HTTP1.1版本。</p> <h5 id="第二部分：请求头部，紧接着请求行（即第一行）之后的部分，用来说明服务器要使用的附加信息"><a href="#第二部分：请求头部，紧接着请求行（即第一行）之后的部分，用来说明服务器要使用的附加信息" class="header-anchor">#</a> 第二部分：请求头部，紧接着请求行（即第一行）之后的部分，用来说明服务器要使用的附加信息</h5> <p>从第二行起为请求头部，HOST将指出请求的目的地.User-Agent,服务器端和客户端脚本都能访问它,它是浏览器类型检测逻辑的重要基础.该信息由你的浏览器来定义,并且在每个请求中自动发送等等</p> <h5 id="第三部分：空行，请求头部后面的空行是必须的"><a href="#第三部分：空行，请求头部后面的空行是必须的" class="header-anchor">#</a> 第三部分：空行，请求头部后面的空行是必须的</h5> <p>即使第四部分的请求数据为空，也必须有空行。</p> <h5 id="第四部分：请求数据也叫主体，可以添加任意的其他数据。"><a href="#第四部分：请求数据也叫主体，可以添加任意的其他数据。" class="header-anchor">#</a> 第四部分：请求数据也叫主体，可以添加任意的其他数据。</h5> <h4 id="_2-http状态码"><a href="#_2-http状态码" class="header-anchor">#</a> 2. 	HTTP状态码</h4> <p>1xx：指示信息--表示请求已接收，继续处理</p> <p>2xx：成功--表示请求已被成功接收、理解、接受</p> <p>3xx：重定向--要完成请求必须进行更进一步的操作</p> <p>4xx：客户端错误--请求有语法错误或请求无法实现</p> <p>5xx：服务器端错误--服务器未能实现合法的请求</p> <p>常见状态码：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>200 OK                        //客户端请求成功
400 Bad Request               //客户端请求有语法错误，不能被服务器所理解
401 Unauthorized              //请求未经授权，这个状态代码必须和WWW-Authenticate报头域一起使用 
403 Forbidden                 //服务器收到请求，但是拒绝提供服务
404 Not Found                 //请求资源不存在，eg：输入了错误的URL
500 Internal Server Error     //服务器发生不可预期的错误
503 Server Unavailable        //服务器当前不能处理客户端的请求，一段时间后可能恢复正常
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_4-https协议"><a href="#_4-https协议" class="header-anchor">#</a> 4.	HTTPS协议</h3> <p>HTTPS是身披SSL外壳的HTTP。HTTPS是一种通过计算机网络进行安全通信的传输协议，经由HTTP进行通信，利用SSL/TLS建立全信道，加密数据包。HTTPS使用的主要目的是提供对网站服务器的身份认证，同时保护交换数据的隐私与完整性。HTTPS为了追求性能，又要保证安全，采用了<strong>共享密钥加密和公开密钥加密混合</strong>的方式进行报文传输。</p> <p>公钥加密为了数据机密;私钥加密为了数据来源可靠、合法;</p> <h4 id="_1-握手的详细过程"><a href="#_1-握手的详细过程" class="header-anchor">#</a> 1. 	握手的详细过程</h4> <p><img src="/assets/image/TCPIP%E5%8D%8F%E8%AE%AE%E6%A0%88.assets/https%E6%8F%A1%E6%89%8B.png" alt="https握手"></p> <p><img src="/assets/image/TCPIP%E5%8D%8F%E8%AE%AE%E6%A0%88.assets/https%E8%AF%A6%E7%BB%86.png" alt="https详细"></p> <p><strong>HTTPS加密请求（四次握手）过程</strong></p> <ul><li><p>客户端向服务器发送Client Hello消息，消息以明文的形式传输，里面包括客户端支持的协议版本、加密套件、压缩算法、客户端生成的一个随机数R1、扩展字段等。其中加密套件是四个功能的组合，即：认证算法（Au）、密钥交换算法（KeyExchange）、对称加密算法（Enc）和信息摘要算法，随机数R1则会在后面的密钥生成中使用到。</p></li> <li><p>① 应对客户端发来的Client Hello，服务器将发送Server Hello消息进行响应，该消息以明文的形式传输，相应消息包括确认使用的协议版本、由服务器生成的随机数R2，确认使用的加密套件、确认使用的压缩方法。</p> <p>② 在发完Server Hello消息后，服务器会马上将自己的Certificate（公钥证书）发送给客户端。</p> <p>③ Server Key Exchange并非必需选项，只有在选用了DH算法的情况下，服务器需要将DH参数发送给客户端，若选择了RSA算法则不需要发送Server Key Exchange。</p> <p>④ Certificate Request也并非必须选项，在对于安全性要求较高的场景中，服务器可要对客户端的身份进行认证，因此发起了对客户端公钥证书的请求，一般情况下浏览器都会内置一对独一无二的公私钥。</p> <p>⑤ 由于第二次握手中包含一些可选选项，因此需要服务器发送一个Server Hello Done的消息，用来通知客户端Server Hello过程结束。</p> <p>客户端收到Server Hello Done之后对服务器传来的证书进行验证，一般会验证证书是否在有效期内，随后根据CRL或者OCSP查询证书是否有效，最后根据证书链从根CA开始验证直到网站证书，以确保证书的真实性。在这个过程中若出现了验证不通过的结果，则抛出相应的错误；若验证通过，就再生成一个随机数Pre-master，并用服务器公钥进行加密，生成PreMaster Key。</p></li> <li><p>① Client Key Exchange就是客户端将PreMaster Key发送给服务器，服务器则会用自己的私钥解密得出Pre-master。到这里客户端和服务器都拥有了三个随机数R1、R2和Pre-master，两边再用相同的算法和这三个随机数生成一个密钥，用于握手结束后传输数据的对称加密。</p> <p>② Change Cipher Spec是客户端向服务器通知，后面发送的消息都会使用协商出来的密钥进行加密。</p> <p>③ Encrypted Handshake Message是客户端向服务发送握手数据加密信息，该信息是客户端将前面<strong>发送和接受</strong>的握手消息利用协商好的摘要算法生成摘要，再用协商好的密钥对摘要进行加密而的出来的，最后将加密信息发送给服务器，这是客户端发出的第一条加密信息。而服务器也会用协商好的密钥进行解密，若能成功解密则说明协商出来的密钥是一致的。</p> <p>④ Certificate是在第二次握手的第4步有进行的情况下，即服务器有向客户端请求证书的情况才会有的，这一步是客户端向服务器发送客户端的证书，而服务器收到证书后也会对证书进行相同的验证。</p></li> <li><p>① Change Cipher Spec是服务器向客户端通知，后面发送的消息都会使用协商出来的密钥进行加密。</p> <p>② Encrypted Handshake Message与第三次握手类似，是服务器发给客户端的用来确定协商的密钥是一致的，也是一条Server Finish消息。</p></li></ul> <h4 id="_2-加密原理和过程"><a href="#_2-加密原理和过程" class="header-anchor">#</a> 2. 	加密原理和过程</h4> <ul><li>非对称加密算法：RSA，DSA/DSS</li> <li>对称加密算法：AES，RC4，3DES</li> <li>信息摘要算法：MD5，SHA1，SHA256</li></ul> <p><img src="/assets/image/TCPIP%E5%8D%8F%E8%AE%AE%E6%A0%88.assets/https%E5%8A%A0%E5%AF%86.jpg" alt="https加密"></p> <h4 id="_3-摘要算法"><a href="#_3-摘要算法" class="header-anchor">#</a> 3.	摘要算法</h4> <ul><li>1、MD5 (Message Digest algorithm 5 消息摘要算法版本5)</li> <li>2、SHA (Secure Hash Algorithm 安全散列算法)</li> <li>3、MAC (Hash Message Authentication Code 散列消息鉴别码)</li></ul> <p>消息摘要（Message Digest）又称为数字摘要（Digital Digest）。它是一个唯一对应一个消息或文本的固定长度的值，由一个单向Hash加密函数对消息进行作用而产生。如果消息在途中改变了，则接收者通过对收到消息的新产生的摘要与原摘要比较，就可知道消息是否被改变了。因此消息摘要保证了消息的完整性。</p> <p>消息摘要采用单向Hash函数将需加密的明文&quot;摘要&quot;成一串固定位数（如128bit）的密文，这一串密文亦称为数字指纹（Finger Print），它有固定的长度，且不同的明文摘要成密文，其结果总是不同的，而同样的明文其摘要必定一致。这样这串摘要便可成为验证明文是否是“真身”的“指纹”了。</p> <p>消息摘要具有不可逆性，在消息摘要生成过程中，会丢失很多原文的信息，而且无法找回。一个好的摘要算法，是极难产生Hash碰撞的，也就是找到另一段明文经计算后产生相同的摘要。</p> <h4 id="_4-数字签名：私钥加密，公钥验签"><a href="#_4-数字签名：私钥加密，公钥验签" class="header-anchor">#</a> 4.	数字签名：私钥加密，公钥验签</h4> <p>发送方：</p> <blockquote><p>1、用哈希函数将报文明文生成报文摘要</p> <p>2、将摘要用私钥加密，生成数字签名</p> <p>3、将明文和数字签名一起发送</p></blockquote> <p>接收方：</p> <blockquote><p>1、用哈希函数将报文明文生成报文摘要</p> <p>2、用公钥将数字签名解密，获取摘要</p> <p>3、比较1和2步骤的摘要</p></blockquote> <h4 id="_5-数字证书"><a href="#_5-数字证书" class="header-anchor">#</a> 5.	数字证书</h4> <p>包含主机机构名称、公钥、CA的数字签名（CA用自己的私钥加密主机的公钥,防止公钥被冒充）。</p></div> <footer class="page-edit" style="display:none;"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">2022/10/6 13:07:49</span></div></footer> <!----> <!----> <!----></main> <!----></div></div></div></div><div class="global-ui"><div class="Sakura" data-v-248d85d6><canvas id="canvas_sakura" style="z-index:2;" data-v-248d85d6></canvas></div><!----><div class="RibbonAnimation"></div><div id="goTop" class="hide-cat" data-v-bf92849a></div><div></div><div id="live2d-widget" class="live2d-widget-container" style="position:fixed;left:65px;bottom:0px;width:135px;height:300px;z-index:99999;opacity:1;pointer-events:none;"><canvas id="live2d_canvas" width="135" height="300" class="live2d_canvas" style="position:absolute;left:0px;top:0px;width:135px;height:300px;"></canvas></div></div></div>
    <script src="/assets/js/app.1dfee411.js" defer></script><script src="/assets/js/3.ff3158d3.js" defer></script><script src="/assets/js/1.3cfe66ce.js" defer></script><script src="/assets/js/37.2d252ea1.js" defer></script>
  </body>
</html>
