(window.webpackJsonp=window.webpackJsonp||[]).push([[52],{530:function(s,a,t){"use strict";t.r(a);var e=t(0),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"_1-开始"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-开始"}},[s._v("#")]),s._v(" 1.开始")]),s._v(" "),a("p",[s._v("工欲善其事，必先利其器。\n软件安装以及配置可以参考，内含实验源码。")]),s._v(" "),a("blockquote",[a("p",[a("a",{attrs:{href:"https://github.com/heartape/study-nasm",target:"_blank",rel:"noopener noreferrer"}},[s._v("study-nasm"),a("OutboundLink")],1)])]),s._v(" "),a("h2",{attrs:{id:"_2-基本运算符"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-基本运算符"}},[s._v("#")]),s._v(" 2.基本运算符")]),s._v(" "),a("div",{staticClass:"language-nasm line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nasm"}},[a("code",[s._v("AND\nOR\nXOR     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 常用于置0")]),s._v("\nTEST\nNOT\n\nADD\nADC     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 带进位加法")]),s._v("\nSUB\nSBB     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 带进位减法")]),s._v("\nMUL\t"),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("bl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("bl")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; bx -> ax * bx")]),s._v("\nIMUL    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 有符号乘")]),s._v("\nDIV\t"),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("ax")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v("..."),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("ah")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; (dx + ax) -> ax...dx")]),s._v("\nIDIV    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 有符号除")]),s._v("\nINC\nDEC\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("div",{staticClass:"language-nasm line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nasm"}},[a("code",[s._v("shl        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";左移")]),s._v("\nshr        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";右移")]),s._v("\nsal        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";有符号左移")]),s._v("\nsar        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";有符号右移")]),s._v("\nrol        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";循环左移")]),s._v("\nror        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";循环右移")]),s._v("\nrcl        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";带进位的循环左移")]),s._v("\nrcr        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";带进位的循环右移")]),s._v("\nshld       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";双精度左移")]),s._v("\nshrd       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";双精度右移")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("div",{staticClass:"language-nasm line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nasm"}},[a("code",[s._v("movsb       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";字节")]),s._v("\nmovsw       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";字")]),s._v("\nmovsd       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";双字")]),s._v("\nmovsq       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";四字")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("div",{staticClass:"language-nasm line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nasm"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; Convert Byte to Word: AL -> AX")]),s._v("\ncbw\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; Convert Word to Double-word:  AX -> DX:AX")]),s._v("\ncwd\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("div",{staticClass:"language-nasm line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nasm"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";标志寄存器判断")]),s._v("\nJC      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";（Jump if Carry）当运算产生进位标志时，即CF=1时，跳转到目标程序处")]),s._v("\nJNC     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";当CF=0时跳转")]),s._v("\nJZ      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";当ZF=1时跳转")]),s._v("\nJNZ     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";当ZF=0时跳转")]),s._v("\nJO      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";当OF=1时跳转")]),s._v("\nJNO     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";当OF=0时跳转")]),s._v("\nJP      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";当PF=1时跳转")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 依此类推，标志寄存器的各个位都有对应指令")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 大小判断")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; A大于，B小于，E等于，N取反")]),s._v("\ncmp "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("ax")]),s._v(","),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("bx")]),s._v("\nJA      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";表示ax>bx")]),s._v("\nJNA     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";表示ax<=bx")]),s._v("\nJB      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";表示ax<bx")]),s._v("\nJNB     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";表示ax>=bx")]),s._v("\nJE      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";表示ax=bx")]),s._v("\nJNE     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";表示ax<>bx")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";JAE、JNAE、JBE、JNBE.....")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";以上是无符号数的比较。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";有符号数的比较将A换成G，将B换成L即可。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";A=above B=below G=greater L=less")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])]),a("div",{staticClass:"language-nasm line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nasm"}},[a("code",[s._v("ret  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";ip")]),s._v("\nretf "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";ip、cs")]),s._v("\niref "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";ip、cs、flag")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h2",{attrs:{id:"_3-实模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-实模式"}},[s._v("#")]),s._v(" 3.实模式")]),s._v(" "),a("h3",{attrs:{id:"_1-引导扇区"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-引导扇区"}},[s._v("#")]),s._v(" 1.引导扇区")]),s._v(" "),a("div",{staticClass:"language-nasm line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nasm"}},[a("code",[s._v("times "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("510")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" ("),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("$")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("$")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("$")]),s._v(") db "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";计算需要填充的空格")]),s._v("\ndb "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("55h")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0aah")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";必须已55aa结尾,并且必须填满一个扇区")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"_2-用户程序头部"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-用户程序头部"}},[s._v("#")]),s._v(" 2.用户程序头部")]),s._v(" "),a("div",{staticClass:"language-nasm line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nasm"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SECTION header")]),s._v(" vstart"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n    program_length  dd program_end                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";1.用户程序的尺寸 dd progarm_end")]),s._v("\n    code_entry      dw start                        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";2.应用程序的入口点 dw 偏移地址")]),s._v("\n                    dd section.code.start                              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";dd 段地址")]),s._v("\n    realloc_tbl_len dw (header_end"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("code_segment)"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";3.段重定位表长度 dw 长度")]),s._v("\n    code_segment    dd section.code.start           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";4.段重定位表数据 dd section.xxx.start")]),s._v("\n    data_segment    dd section.data.start\n    stack_segment   dd section.stack.start\n"),a("span",{pre:!0,attrs:{class:"token label function"}},[s._v("header_ends:")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("div",{staticClass:"language-nasm line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nasm"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";重定位段重定位表")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";将虚拟地址转换为实际的16位物理地址，用于[cs:ip]跳转")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";输入：DX-高16位地址,AX-低16位地址")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";返回：AX=16位段基地址 ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token label function"}},[s._v("calc_segment_base:")]),s._v("\n\tpush "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("dx")]),s._v("                          \n\n\tadd "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("ax")]),s._v(","),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("cs")]),s._v(":phy_base"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("]")]),s._v("\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";phy_base低16位")]),s._v("\n\tadc "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("dx")]),s._v(","),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("cs")]),s._v(":phy_base"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x02")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("]")]),s._v("\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";phy_base高16位")]),s._v("\n\tshr "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("ax")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\t\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";右移")]),s._v("\n\tror "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("dx")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\t\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";循环右移")]),s._v("\n\tand "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("dx")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0xf000")]),s._v("\n\tor "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("ax")]),s._v(","),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("dx")]),s._v(" \t\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";将高四位地址转移到低16位组成段地址,为什么需要转为物理段地址？")]),s._v("\n\n\tpop "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("dx")]),s._v("\n\tret\n\n    phy_base dd "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x10000")]),s._v("             "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";用户程序被加载的物理起始地址")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("h3",{attrs:{id:"_3-io"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-io"}},[s._v("#")]),s._v(" 3.io")]),s._v(" "),a("div",{staticClass:"language-nasm line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nasm"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";硬盘总共8个端口，每个端口8位")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";使用LBA28方式访问硬盘")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";0x1f2端口写入扇区数")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";需要28个比特来表示起始逻辑扇区号:0x1f3(8位)、0x1f4(8位)、0x1f5(8位)、0x1f6(4位)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";0x1f6(8位) -> 固定1 + 0(CHS)/1(LAB) + 固定1 + 0(主硬盘)/1(从硬盘) + 4位用于表示逻辑扇区号")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";0x1f7(8位) -> 1(忙)/0 + 空x3 + 1(准备好交换数据)/0 + 空x2 + 1(前一个命令执行错误)/0")]),s._v("\n\nmov "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("dx")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x1f2")]),s._v("\nmov "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x01")]),s._v("\nout "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("dx")]),s._v(","),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";0x1f2 -> 扇区数")]),s._v("\n\nmov "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("dx")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x1f3")]),s._v("\nmov "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x02")]),s._v("\nout "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("dx")]),s._v(","),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";0x1f3")]),s._v("\n\ninc "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("dx")]),s._v("\nmov "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x00")]),s._v("\nout "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("dx")]),s._v(","),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";0x1f4")]),s._v("\n\ninc "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("dx")]),s._v("\nout "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("dx")]),s._v(","),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";0x1f5")]),s._v("\n\ninc "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("dx")]),s._v("\nmov "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0xe0")]),s._v("\nout "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("dx")]),s._v(","),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";0x1f6")]),s._v("\n\nmov "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("dx")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x1f7")]),s._v("\nmov "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x20")]),s._v("\nout "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("dx")]),s._v(","),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";0x1f7 -> 0x20(读)")]),s._v("\n\nmov "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("dx")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x1f7")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token label function"}},[s._v(".waits:")]),s._v("\nin "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v(","),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("dx")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";0x1f7")]),s._v("\nand "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x88")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";0B10001000")]),s._v("\ncmp "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x08")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";0B00001000，查看是否准备好读取")]),s._v("\njnz .waits\n \nmov "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("cx")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("256")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";读取一个扇区256字节")]),s._v("\nmov "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("dx")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x1f0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token label function"}},[s._v(".read:")]),s._v("\nin "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("ax")]),s._v(","),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("dx")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";0x1f0数据端口")]),s._v("\nmov "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("bx")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("]")]),s._v(","),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("ax")]),s._v("\nadd "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("bx")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\nloop .read\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br")])]),a("h3",{attrs:{id:"_4-显卡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-显卡"}},[s._v("#")]),s._v(" 4.显卡")]),s._v(" "),a("div",{staticClass:"language-nasm line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nasm"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";请求操作0x0e号寄存器")]),s._v("\nmov "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("dx")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x3d4")]),s._v("\nmov "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x0e")]),s._v("\nout "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("dx")]),s._v(","),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";读取屏幕光标位置的高8位")]),s._v("\nmov "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("dx")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x3d5")]),s._v("\nin "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x0e")]),s._v("\nmov "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("ah")]),s._v(","),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";写入屏幕光标位置的高8位")]),s._v("\nmov "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("dx")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x3d5")]),s._v("\nmov "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x0e")]),s._v("\nout "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("dx")]),s._v(","),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";请求操作0x0f号寄存器")]),s._v("\nmov "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("dx")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x3d4")]),s._v("\nmov "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x0f")]),s._v("\nout "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("dx")]),s._v(","),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";读取屏幕光标位置的低8位")]),s._v("\nmov "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("dx")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x3d5")]),s._v("\nmov "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x0f")]),s._v("\nin "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v(","),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("dx")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";ax完整光标数据")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";写入屏幕光标位置的低8位")]),s._v("\nmov "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("dx")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x3d5")]),s._v("\nmov "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x0f")]),s._v("\nout "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("dx")]),s._v(","),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v("\n\ncmp "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("cl")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x0d")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";是否回车符")]),s._v("\ncmp "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("cl")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x0a")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";是否换行符")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br")])]),a("h3",{attrs:{id:"_5-中断"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-中断"}},[s._v("#")]),s._v(" 5.中断")]),s._v(" "),a("div",{staticClass:"language-nasm line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nasm"}},[a("code",[s._v("cli     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";禁止中断")]),s._v("\nsti     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";允许中断")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("div",{staticClass:"language-nasm line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nasm"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";RTC 芯片设置")]),s._v("\nmov "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x0b")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";RTC寄存器B的索引")]),s._v("\nor "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x80")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";将 AL 的最高位置1,阻断NMI（表 9-2）")]),s._v("\nout "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x70")]),s._v(","),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";端口0x70是RTC的寄存器地址索引端口")]),s._v("\nmov "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x12")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";设置寄存器B的数据，禁止周期性中断，允许更新结束中断允许，BCD码，24小时制（表 9-3）")]),s._v("\nout "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x71")]),s._v(","),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";端口0x71是RTC的数据端口")]),s._v("\n\nmov "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x0c")]),s._v("\nout "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x70")]),s._v(","),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v("\nin "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x71")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";读RTC寄存器C，表明中断已经得到处理，可以继续下一次中断，否则不会产生中断信号（不考虑闹钟和周期性中断的情况）")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";修改它内部的中断屏蔽寄存器 IMR,以允许中断")]),s._v("\nin "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0xa1")]),s._v("                         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";从0xa1端口读8259从片的IMR寄存器")]),s._v("\nand "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0xfe")]),s._v("                        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";清除bit 0(此位连接RTC，见书图 9-2)")]),s._v("\nout "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0xa1")]),s._v(","),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v("                        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";写回此寄存器")]),s._v("\n\nhlt             "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";使CPU进入低功耗状态，直到被中断唤醒，可用于循环等待降低功耗")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";读RTC当前时间")]),s._v("\nxor "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v(","),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";0 -> 秒，2 -> 分，4 -> 时")]),s._v("\nor "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x80")]),s._v("\nout "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x70")]),s._v(","),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v("\nin "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x71")]),s._v("\npush "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("ax")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br")])]),a("h3",{attrs:{id:"_6-键盘"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-键盘"}},[s._v("#")]),s._v(" 6.键盘")]),s._v(" "),a("div",{staticClass:"language-nasm line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nasm"}},[a("code",[s._v("mov "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("ah")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x00")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";从键盘读字符")]),s._v("\nint "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x16")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";键盘服务，会持续监控键盘。返回时，字符代码在寄存器 AL 中")]),s._v("\n\nin "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x60")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";通过端口读取，由0x9中断读取")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"其他"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#其他"}},[s._v("#")]),s._v(" 其他")]),s._v(" "),a("ul",[a("li",[s._v("字在内存中是小端存储")]),s._v(" "),a("li",[s._v("双字在内存中也是小端存储")])]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# c风格表示法\n0x12 -> 16进制\n0O12 -> 8进制\n0B12 -> 2进制\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("div",{staticClass:"language-nasm line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nasm"}},[a("code",[s._v("shl "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("ax")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";左移")]),s._v("\nshr "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("ax")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";右移")]),s._v("\nrol "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("ax")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";循环左移,移出的比特既送到标志寄存器的CF位，也送进右边空出的位")]),s._v("\nror "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("ax")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";循环右移,同上")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("div",{staticClass:"language-nasm line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nasm"}},[a("code",[s._v("length equ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";声明常数 xxx equ 100,不会占用内存")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language-nasm line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nasm"}},[a("code",[s._v("resb "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("256")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";（REServe Byte）内存中保留 256 字节")]),s._v("\nresw "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("256")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";内存中保留 256 字")]),s._v("\nresd "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("256")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";内存中保留 256 双字")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h2",{attrs:{id:"_4-32位保护模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-32位保护模式"}},[s._v("#")]),s._v(" 4.32位保护模式")]),s._v(" "),a("h3",{attrs:{id:"_1-保护模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-保护模式"}},[s._v("#")]),s._v(" 1.保护模式")]),s._v(" "),a("div",{staticClass:"language-nasm line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nasm"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 16位模式下运行32位指令，机器码前会加上 0x66，32位模式下运行16位指令同理")]),s._v("\ninc "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("ax")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 40")]),s._v("\ninc "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("eax")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 66 40")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("[")]),s._v("bits "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("]")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 指定编译模式，默认16")]),s._v("\n\nshl "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("eax")]),s._v(","),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("cl")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 32位首先会做如下运算，保留后五位: and cl 0x1F，因此移动的次数最大为31")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h3",{attrs:{id:"_2-进入保护模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-进入保护模式"}},[s._v("#")]),s._v(" 2.进入保护模式")]),s._v(" "),a("div",{staticClass:"language-nasm line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nasm"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 这部分是基于linux0.11的源码")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 把后面的值（gdt_48）放在 gdtr 寄存器中")]),s._v("\nlgdt  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("[")]),s._v("gdt_48"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("]")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; gdtr 寄存器")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token label function"}},[s._v("gdt_48:")]),s._v("\n    dw   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x800")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; gdt limit=2048, 256 GDT entries")]),s._v("\n    dw   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("512")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("gdt,"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x9")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; gdt base = 0X9xxxx")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; gdt(全局描述符表)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token label function"}},[s._v("gdt:")]),s._v("\n    dw   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 首个为空")]),s._v("\n\n    dw   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x07FF")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 8Mb - limit=2047 (2048*4096=8Mb)")]),s._v("\n    dw   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x0000")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; base address=0")]),s._v("\n    dw   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x9A00")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; code read/exec")]),s._v("\n    dw   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x00C0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; granularity=4096, 386")]),s._v("\n\n    dw   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x07FF")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 8Mb - limit=2047 (2048*4096=8Mb)")]),s._v("\n    dw   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x0000")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; base address=0")]),s._v("\n    dw   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x9200")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; data read/write")]),s._v("\n    dw   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x00C0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; granularity=4096, 386")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("div",{staticClass:"language-nasm line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nasm"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 打开 A20 地址线，为了突破地址信号线 20 位的宽度，变成 32 位可用。")]),s._v("\nmov "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0xD1")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; command write")]),s._v("\nout "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x64")]),s._v(","),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v("\nmov "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0xDF")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; A20 on")]),s._v("\nout "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x60")]),s._v(","),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("div",{staticClass:"language-nasm line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nasm"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 对可编程中断控制器 8259 芯片进行的编程")]),s._v("\nmov "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x11")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; initialization sequence")]),s._v("\nout "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x20")]),s._v(","),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; send it to 8259A-1")]),s._v("\ndw   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x00eb")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x00eb")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; jmp $+2, jmp $+2")]),s._v("\nout "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0xA0")]),s._v(","),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; and to 8259A-2")]),s._v("\ndw   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x00eb")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x00eb")]),s._v("\nmov "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x20")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; start of hardware int's (0x20)")]),s._v("\nout "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x21")]),s._v(","),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v("\ndw   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x00eb")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x00eb")]),s._v("\nmov "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x28")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; start of hardware int's 2 (0x28)")]),s._v("\nout "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0xA1")]),s._v(","),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v("\ndw   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x00eb")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x00eb")]),s._v("\nmov "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x04")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 8259-1 is master")]),s._v("\nout "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x21")]),s._v(","),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v("\ndw   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x00eb")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x00eb")]),s._v("\nmov "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x02")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 8259-2 is slave")]),s._v("\nout "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0xA1")]),s._v(","),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v("\ndw   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x00eb")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x00eb")]),s._v("\nmov "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x01")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 8086 mode for both")]),s._v("\nout "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x21")]),s._v(","),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v("\ndw   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x00eb")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x00eb")]),s._v("\nout "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0xA1")]),s._v(","),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v("\ndw   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x00eb")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x00eb")]),s._v("\nmov "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0xFF")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; mask off all interrupts for now")]),s._v("\nout "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x21")]),s._v(","),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v("\ndw   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x00eb")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x00eb")]),s._v("\nout "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0xA1")]),s._v(","),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("al")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br")])]),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 编程后的中断\nPIC 请求号\t中断号\t用途\nIRQ0\t0x20\t时钟中断\nIRQ1\t0x21\t键盘中断\nIRQ2\t0x22\t接连从芯片\nIRQ3\t0x23\t串口2\nIRQ4\t0x24\t串口1\nIRQ5\t0x25\t并口2\nIRQ6\t0x26\t软盘驱动器\nIRQ7\t0x27\t并口1\nIRQ8\t0x28\t实时钟中断\nIRQ9\t0x29\t保留\nIRQ10\t0x2a\t保留\nIRQ11\t0x2b\t保留\nIRQ12\t0x2c\t鼠标中断\nIRQ13\t0x2d\t数学协处理器\nIRQ14\t0x2e\t硬盘中断\nIRQ15\t0x2f\t保留\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("div",{staticClass:"language-nasm line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nasm"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 正式进入保护模式")]),s._v("\nmov "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("ax")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x0001")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; protected mode (PE) bit")]),s._v("\nlmsw "),a("span",{pre:!0,attrs:{class:"token register variable"}},[s._v("ax")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; This is it; 将 cr0 这个寄存器的位 0 置 1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 段选择子结构（16位） 0~1：RPL，2：TI，3~15：描述符索引（需要跳转的段基址在gdt中的位置）")]),s._v("\njmpi "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(","),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 8 -> 0000_0000_0000_1000 -> 0_0000_0000_0001 -> 1")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])])}),[],!1,null,null,null);a.default=n.exports}}]);