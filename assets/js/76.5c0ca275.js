(window.webpackJsonp=window.webpackJsonp||[]).push([[76],{556:function(s,n,t){"use strict";t.r(n);var a=t(0),e=Object(a.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"_1-简介"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-简介"}},[s._v("#")]),s._v(" 1.简介")]),s._v(" "),n("p",[s._v("之前一直想搭建一个私人图床，但是找了好久，一般都是基于php或nodejs的较为复杂，但当我第一眼看到minio，就决定是它了。\nMinIO 是一款高性能、分布式的对象存储系统，专为云原生设计。使用也是非常的广泛。")]),s._v(" "),n("h2",{attrs:{id:"_2-搭建"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-搭建"}},[s._v("#")]),s._v(" 2.搭建")]),s._v(" "),n("p",[s._v("为了方便，我直接使用了docker搭建了单机版。")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('// 9000为后台api端口，9090为browser端口\ndocker run -p 9000:9000 -p 9090:9090 \\\n--name minio \\\n-d --restart=always \\\n-v /opt/minio/data:/data \\\n-v /opt/minio/config.env:/etc/config.env \\\n-e "MINIO_CONFIG_ENV_FILE=/etc/config.env" \\\nminio/minio server \\\n/data --console-address ":9090" -address ":9000"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('// config.env配置文件需要提前创建，来自官网\n# MINIO_ROOT_USER and MINIO_ROOT_PASSWORD sets the root account for the MinIO server.\n# This user has unrestricted permissions to perform S3 and administrative API operations on any resource in the deployment.\n# Omit to use the default values \'minioadmin:minioadmin\'.\n# MinIO recommends setting non-default values as a best practice, regardless of environment\n\nMINIO_ROOT_USER=myminioadmin\nMINIO_ROOT_PASSWORD=minio-secret-key-change-me\n\n# MINIO_VOLUMES sets the storage volume or path to use for the MinIO server.\n\nMINIO_VOLUMES="/mnt/data"\n\n# MINIO_SERVER_URL sets the hostname of the local machine for use with the MinIO Server\n# MinIO assumes your network control plane can correctly resolve this hostname to the local machine\n\n# Uncomment the following line and replace the value with the correct hostname for the local machine.\n\n# MINIO_SERVER_URL="http://minio.example.net"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("h2",{attrs:{id:"_3-分享链接"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-分享链接"}},[s._v("#")]),s._v(" 3.分享链接")]),s._v(" "),n("p",[s._v("按照以上的方法启动容器后，就可以使用了。但是在分享链接的时候，却发现链接上并不是我们的域名，而是内网ip。进入dockers打印日志可以发现")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("[root@23fsw3213ffsd4t5 ~]# docker logs minio\nAPI: http://172.xx.x.x:9000  http://127.0.0.1:9000\nConsole: http://172.xx.x.x:9090 http://127.0.0.1:9090\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("可以发现并没有指向我们的域名。")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# 在config.env增加以下配置\nMINIO_SERVER_URL=https://server.minio.heartape.com\nMINIO_BROWSER_REDIRECT_URL=https://minio.heartape.com\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("再重启后查看日志就发现已经正常：")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("[root@23fsw3213ffsd4t5 ~]# docker logs minio\nAPI: https://server.minio.heartape.com\nConsole: https://minio.heartape.com\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("但是问题又来了，登录提示")]),s._v(" "),n("blockquote",[n("p",[s._v("invalid login")])]),s._v(" "),n("p",[s._v("麻了，翻了好久发现中国这届网友不行，去github官方仓库找到了答案，原来需要在nginx增加配置")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('# 这里只列出了官方方案上的所有配置，9000同理，顺带解决了文件过大无法上传的问题\nserver {\n    listen       443 ssl;\n    listen  [::]:443 ssl;\n    server_name  minio.heartape.com;\n    \n    ignore_invalid_headers off;\n    client_max_body_size 0;\n    proxy_buffering off;\n\n    location / {\n        proxy_pass http://172.24.xx.xxx:9090/;\n        \n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n        proxy_set_header Host $http_host;\n\n        proxy_connect_timeout 300;\n        # Default is HTTP/1, keepalive is only enabled in HTTP/1.1\n        proxy_http_version 1.1;\n        proxy_set_header Connection "";\n        chunked_transfer_encoding off;\n    }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br")])]),n("p",[s._v("自此，简单单机版搭建完成。")]),s._v(" "),n("h2",{attrs:{id:"_4-语法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-语法"}},[s._v("#")]),s._v(" 4. 语法")]),s._v(" "),n("blockquote",[n("p",[s._v("对象存储规范 https://docs.aws.amazon.com/AmazonS3/latest/userguide/using-with-s3-actions.html")])]),s._v(" "),n("div",{staticClass:"language-json line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"Version"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2012-10-17"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"Statement"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"Effect"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Allow"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"Action"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s3:GetBucketLocation"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s3:ListBucket"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s3:GetObject"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s3:PutObject"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 批量")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s3:AbortMultipartUpload"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s3:ListMultipartUploadParts"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s3:ListBucketMultipartUploads"')]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"Resource"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"arn:aws:s3:::blog/*"')]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br")])]),n("p",[s._v("Effect:")]),s._v(" "),n("ul",[n("li",[s._v("Allow")]),s._v(" "),n("li",[s._v("Deny")])]),s._v(" "),n("p",[s._v("Action:")]),s._v(" "),n("ul",[n("li",[s._v("s3:GetObject")]),s._v(" "),n("li",[s._v("s3:ListBucket")]),s._v(" "),n("li",[s._v("s3:PutObject:旧版本有bug，不加PutObject的话browser无法进入bucket，看github上说新版本应该解决了，但官方容器还是几个月前的。")]),s._v(" "),n("li",[s._v("s3:GetBucketLocation")]),s._v(" "),n("li",[s._v("s3:DeleteObject")]),s._v(" "),n("li",[s._v("s3:AbortMultipartUpload")]),s._v(" "),n("li",[s._v("s3:ListBucketMultipartUploads")]),s._v(" "),n("li",[s._v("s3:ListMultipartUploadParts")]),s._v(" "),n("li",[s._v("......")])]),s._v(" "),n("h2",{attrs:{id:"_5-小结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-小结"}},[s._v("#")]),s._v(" 5.小结")]),s._v(" "),n("p",[s._v("本身minio搭建还是非常简单的，无数据库的方式（php图床需要）使得配置简单且易于迁移，总之就是非常nice。")]),s._v(" "),n("p",[s._v("鉴于其云原生的特性，后续如果有时间和需求，折腾一下kubernetes搭建minio集群。")])])}),[],!1,null,null,null);n.default=e.exports}}]);